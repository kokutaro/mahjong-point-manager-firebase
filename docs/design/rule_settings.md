# ルール設定画面 詳細設計書

## 1. 概要

部屋作成時に、麻雀の各種ルール（点数、ウマ・オカ、特殊役、チップ等）を詳細に設定できる画面を実装する。
`TopPage` から部屋作成ボタンを押下後、即座に部屋を作るのではなく、モーダルまたは別画面でルール設定を行い、その設定を持って部屋を作成するフローに変更する。

## 2. データ構造設計

`GameSettings` インターフェースを拡張し、以下の詳細項目を管理できるようにする。

### 2.1 拡張 `GameSettings` 定義（案）

```typescript
export interface GameSettings {
  // 基本設定
  mode: '4ma' | '3ma'; // 4人麻雀 / 3人麻雀
  length: 'Hanchan' | 'Tonpu'; // 半荘戦 / 東風戦 (将来拡張用、初期は半荘のみでも可)

  // 点数設定
  startPoint: number; // 配給原点 (例: 25000)
  returnPoint: number; // 返し点 (例: 30000)
  uma: [number, number]; // ウマ (例: [10, 30] -> 10-30) / 3麻の場合は [number, number, number] 等考慮が必要だが、基本は4麻ベースで順位ごとに定義

  // 特殊ルール
  hasHonba: boolean; // 積み棒の有無 (デフォルトtrue)
  honbaPoints: number; // 1本場の点数 (300 or 1500)

  // 連荘・親流れ
  tenpaiRenchan: boolean; // テンパイ連荘 (falseならアガリ連荘)

  // 終了条件
  useTobi: boolean; // トビあり

  // チップ
  useChip: boolean; // チップあり
  chipRate: number; // チップ1枚の点数相当 (記録用、オプショナル)

  // その他 (将来拡張)
  allowMultipleRon: 'No' | 'Double' | 'Triple'; // ダブロン/トリプルロン設定
}
```

### 2.2 デフォルト値

- **4麻デフォルト**:
  - 25000点持ち / 30000点返し
  - ウマ 5-10
  - 積み棒 300点
  - テンパイ連荘
  - トビあり
- **3麻デフォルト**:
  - 35000点持ち / 40000点返し
  - ウマ 10-20 (要調整)
  - 積み棒 1500点（ツモ損なしルールの場合などは要検討だが、基本1本場1500点減算/加算が多い）
  - テンパイ連荘
  - トビあり

## 3. 画面UI設計

### 3.1 画面遷移フロー

1. **TopPage**: 「部屋作成」ボタンを押下
   - これまでは `4ma` / `3ma` ボタンが直接作成していたが、これを「ルール設定ダイアログを開く」アクションに変更。
2. **RuleSettingModal (新規コンポーネント)**:
   - モード選択 (タブ切り替え or ラジオボタン: 4人麻雀/3人麻雀)
   - 各種設定フォーム（アコーディオン等でグループ化推奨）
     - **基本グループ**: 配給原点、返し点、ウマ
     - **進行グループ**: 連荘条件、トビ、ダブロン
     - **オプション**: チップ有無
   - **アクション**:
     - 「キャンセル」: モーダルを閉じる
     - 「このルールで作成」: `createRoom` を呼び出し、部屋へ遷移

### 3.2 構成要素 (Inputs)

- **数値入力**: 配給原点、返し点 (100点単位バリデーション)
- **セレクトボックス**: ウマ (5-10, 10-20, 10-30, 20-40, なし, カスタム)
- **スイッチ/チェックボックス**: トビあり、テンパイ連荘、チップあり
- **ラジオボタン**: 4麻/3麻

## 4. 実装計画

### 4.1 変更が必要なファイル

- `src/types/index.ts`: `GameSettings` の型定義アップデート
- `src/services/roomService.ts`: `createRoom` が `GameSettings` オブジェクト全体を受け取れるように変更。`initialRoomState` の生成ロジック更新。
- `src/components/CreateRoomModal.tsx` (新規): ルール設定UIの実装。
- `src/pages/TopPage.tsx`: モーダル呼び出し処理の追加。

### 4.2 バリデーション

- 配給原点 <= 返し点 であること（通常）
- ウマの合計が0であること（必須ではないが、一般的なセット麻雀では0合わせ）→ アプリ上は順位ウマを入力させるため、自動計算でもよい。
  - _簡易実装案_: プリセットから選択させる形式を基本とし、カスタム入力は後回しにする。
